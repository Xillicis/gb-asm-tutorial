<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>GB ASM Tutorial</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="The single, most comprehensive technical reference to Game Boy available to the public.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="css/custom.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="index.html">Home</a></li><li class="chapter-item affix "><a href="roadmap.html">Roadmap</a></li><li class="chapter-item affix "><li class="part-title">Part I - Hello World!</li><li class="chapter-item "><a href="part1/setup.html"><strong aria-hidden="true">1.</strong> Setup</a></li><li class="chapter-item "><a href="part1/hello_world.html"><strong aria-hidden="true">2.</strong> Hello World!</a></li><li class="chapter-item "><a href="part1/toolchain.html"><strong aria-hidden="true">3.</strong> The toolchain</a></li><li class="chapter-item "><a href="part1/bin_and_hex.html"><strong aria-hidden="true">4.</strong> Binary and hexadecimal</a></li><li class="chapter-item "><a href="part1/registers.html"><strong aria-hidden="true">5.</strong> Registers</a></li><li class="chapter-item "><a href="part1/assembly.html"><strong aria-hidden="true">6.</strong> Assembly basics</a></li><li class="chapter-item "><a href="part1/memory.html"><strong aria-hidden="true">7.</strong> Memory</a></li><li class="chapter-item "><a href="part1/operations.html"><strong aria-hidden="true">8.</strong> Operations &amp; flags</a></li><li class="chapter-item "><a href="part1/jumps.html"><strong aria-hidden="true">9.</strong> Jumps</a></li><li class="chapter-item affix "><li class="part-title">Part II - Our first game</li><li class="chapter-item "><div><strong aria-hidden="true">10.</strong> To be written...</div></li><li class="chapter-item affix "><li class="part-title">Part III - Our second game</li><li class="chapter-item "><div><strong aria-hidden="true">11.</strong> To be written...</div></li><li class="spacer"></li><li class="chapter-item affix "><a href="resources.html">Resources</a></li><li class="chapter-item affix "><a href="thanks.html">Thanks</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">GB ASM Tutorial</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/ISSOtm/gb-asm-tutorial" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="home"><a class="header" href="#home">Home</a></h1>
<p>üëã Welcome to gb-asm-tutorial!
This tutorial will teach you how to make games for the Game Boy and Game Boy Color.</p>
<div class="box warning decorated">
<div><p>‚ö†Ô∏è</p></div>
<div>
<p>While the Game Boy and Game Boy Color are almost the same console, <strong>the Game Boy Advance is entirely different</strong>.
However, the GBA is able to run GB and GBC games!
If you are looking to program GBC games and run them on a GBA, you‚Äôre at the right place; however, if you want to make games specifically for the GBA, please check out <a href="http://coranac.com/tonc/text">Tonc</a> instead.</p>
</div>
</div>
<h2 id="controls"><a class="header" href="#controls">Controls</a></h2>
<p>There are some handy icons near the top of your screen!</p>
<ul>
<li>The ‚Äúburger‚Äù <i class="fa fa-bars"></i> toggles the navigation side panel;</li>
<li>The brush <i class="fa fa-paint-brush"></i> allows selecting a different color theme;</li>
<li>The magnifying glass <i class="fa fa-search"></i> pops up a search bar;</li>
<li>The printer <i class="fa fa-print"></i> gives a single-page version of the <em>entire</em> tutorial, which you can print if you want;</li>
<li>The GitHub icon <i class="fa fa-github"></i> links to the tutorial‚Äôs source repository;</li>
<li>The edit button <i class="fa fa-edit"></i> allows you to suggest changes to the tutorial, provided that you have a GitHub account.</li>
</ul>
<p>Additionally, there are arrows to the left and to the right of the page (they are at the bottom instead on mobile) to more easily navigate to the next page.</p>
<p>With that said, you can get started by simply navigating the the following page :)</p>
<h2 id="feedback"><a class="header" href="#feedback">Feedback</a></h2>
<p>If you are stuck in a certain part of the tutorial, want some advice, or just wish to chat with us, <a href="https://gbdev.io/chat">the GBDev community chat</a> is the place to go!
I actively participate there, and don‚Äôt be afraid to ask questions!</p>
<p>If you are interested in contributing to or translating the tutorial, thank you!
Follow the link above, I‚Äôd be happy to work with you.</p>
<p>Noticed a problem with the tutorial?
Please <a href="https://github.com/ISSOtm/gb-asm-tutorial/issues">check out our issue tracker</a>; if there is no open issue about your problem, please create a new one, or reach out to us via the link above.</p>
<p>If you prefer email, my address is <code>tutorial@&lt;domain&gt;</code>, where you replace <code>&lt;domain&gt;</code> with this website‚Äôs domain name (it ends with <code>.fr</code>).
Anti-spam measure, I hope you understand.</p>
<h2 id="licensing"><a class="header" href="#licensing">Licensing</a></h2>
<p><strong>In short</strong>:</p>
<ul>
<li>Code within the tutorial is essentially <strong>public domain</strong>, meaning that you are allowed to copy it freely without restrictions.</li>
<li>You are free to copy the tutorial‚Äôs contents (prose, diagrams, etc.), modify them, and share that, but you must give credit and license any copies permissively.</li>
<li>This site‚Äôs <em>source code</em> can be freely copied, but you must give a license and copyright notice.</li>
</ul>
<p><strong>Full details</strong>, please follow these links for more information on the respective licenses:</p>
<ul>
<li>All of the code contained within the tutorial itself is licensed under <a rel="license" href="http://creativecommons.org/publicdomain/zero/1.0/">CC0</a>. <em>To the extent possible under law, all copyright and related or neighboring rights to code presented within GB ASM Tutorial have been waived. This work is published from France.</em></li>
<li>The contents (prose, images, etc.) of this tutorial are licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</li>
<li>Code used to display and format the site is licensed under the <a href="https://github.com/ISSOtm/gb-asm-tutorial/blob/master/LICENSE">MIT License</a> unless otherwise specified.</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="roadmap"><a class="header" href="#roadmap">Roadmap</a></h1>
<p>The tutorial is split into three sections.
<strong>I strongly advise you go through the tutorial in order!</strong></p>
<p>In Part I, we run our first ‚ÄúHello World!‚Äù program, which we then dissect to learn what makes the Game Boy tick.</p>
<p>In Part II, we program our first game, a clone of <em>Arkanoid</em>; we learn how to prod the hardware into having something we can call a ‚Äúgame‚Äù.
Along the way, we will make plenty of mistakes, so we can learn how to debug our code.</p>
<p>And finally, Part III is about ‚Äúadvanced‚Äù use of the hardware, where we learn how to make even better-looking games, and we program a Shoot ‚ÄòEm Up!</p>
<hr />
<p>Unfortunately, this tutorial is a work in progress.
Currently, <strong>Part I is being written</strong>, and Parts II and III should follow soon after.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="setup"><a class="header" href="#setup">Setup</a></h1>
<p>First, we should set up our dev environment.
We will need:</p>
<ol>
<li>A POSIX environment</li>
<li><a href="https://rgbds.gbdev.io">RGBDS</a> v0.5.1 (though v0.5.0 should be compatible)</li>
<li>GNU Make (preferably a recent version)</li>
<li>A code editor</li>
<li>A debugging emulator</li>
</ol>
<p>üòï‚ùì The following install instructions are provided on a ‚Äúbest-effort‚Äù basis, but may be outdated, or not work for you for some reason.
Don‚Äôt worry, we‚Äôre here to help: <a href="part1/../index.html#feedback">ask away in GBDev</a>, and we‚Äôll help you installing everything!</p>
<h2 id="tools"><a class="header" href="#tools">Tools</a></h2>
<h3 id="linux--macos"><a class="header" href="#linux--macos">Linux &amp; macOS</a></h3>
<p>Good news: you‚Äôre already fulfilling step 1!
You just need to <a href="https://rgbds.gbdev.io/install">install RGBDS</a>, and maybe update GNU Make.</p>
<h4 id="macos"><a class="header" href="#macos">macOS</a></h4>
<p>At the time of writing this, macOS (up to 11.0, the current latest release) ships a very outdated GNU Make.
You can check it by opening a terminal, and running <code>make --version</code>, which should indicate ‚ÄúGNU Make‚Äù and a date, among other things.</p>
<p>If your Make is too old, you can update it using <a href="https://brew.sh">Homebrew</a>‚Äòs formula <a href="https://formulae.brew.sh/formula/make#default"><code>make</code></a>.
At the time of writing, this should print a warning that the updated Make has been installed as <code>gmake</code>; you can either follow the suggestion in order to use it as your ‚Äúdefault‚Äù <code>make</code>, or use <code>gmake</code> instead of <code>make</code> in this tutorial.</p>
<h4 id="linux"><a class="header" href="#linux">Linux</a></h4>
<p>Once RGBDS is installed, open a terminal and run <code>make --version</code> to check your Make version (which is likely GNU Make).</p>
<p>If <code>make</code> cannot be found, you may need to install your distribution‚Äôs <code>build-essentials</code>.</p>
<h3 id="windows"><a class="header" href="#windows">Windows</a></h3>
<p>The sad truth is that Windows is a terrible OS for development; however, you can install environments that solve most issues.</p>
<p>On Windows 10, your best bet is <a href="https://docs.microsoft.com/en-us/windows/wsl">WSL</a>.
Install WSL 1 or WSL 2, install a Linux distribution, and then follow these steps again, but for the Linux distribution you installed.</p>
<p>If WSL is not an option, you can use <a href="https://www.msys2.org">MSYS2</a> or <a href="https://www.cygwin.com">Cygwin</a> instead; then check out the bottom of <a href="https://rgbds.gbdev.io/install/windows">RGBDS‚Äô Windows install instructions</a>.
As far as I‚Äôm aware, both of these provide a sufficiently up-to-date version of GNU Make.</p>
<h2 id="code-editor"><a class="header" href="#code-editor">Code editor</a></h2>
<p>Any code editor is fine; I personally use <a href="https://www.sublimetext.com">Sublime Text</a> with its <a href="https://packagecontrol.io/packages/RGBDS">RGBDS syntax package</a>; however, you can use any text editor, including Notepad, if you‚Äôre crazy enough.
Awesome GBDev has <a href="https://gbdev.io/list.html#asm">a section on syntax highlighting packages</a>, see there if your favorite editor supports RGBDS.</p>
<h2 id="emulator"><a class="header" href="#emulator">Emulator</a></h2>
<p>Using an emulator to play games is one thing; using it to program games is another.
The two aspects an emulator must fulfill to allow an enjoyable programming experience are:</p>
<ul>
<li><strong>Debugging tools</strong>:
When your code goes haywire on an actual console, it‚Äôs very difficult to figure out why or how.
There is no console output, no way to <code>gdb</code> the program, nothing.
However, an emulator can provide debugging tools, allowing you to control execution, inspect memory, etc.
These are vital if you want GB dev to be <em>fun</em>, trust me!</li>
<li><strong>Good accuracy</strong>:
Accuracy means ‚Äúhow faithful to the original console something is‚Äù.
Using a bad emulator for playing games can work (to some extent, and even then...), but using it for <em>developing</em> a game makes it likely to accidentally render your game incompatible with the actual console.
For more info, read <a href="https://arstechnica.com/?post_type=post&amp;p=44524">this article on Ars Technica</a> (especially the ‚ÄúAn emulator for every game‚Äù section at the top of page 2).
You can compare GB emulator accuracy on <a href="https://daid.github.io/GBEmulatorShootout/">Daid‚Äôs GB-emulator-shootout</a>.</li>
</ul>
<p>The emulator I will be using for this tutorial is <a href="https://bgb.bircd.org">BGB</a> (1.5.9 when I‚Äôm writing this).
It‚Äôs Windows-only, but macOS and Linux users can install Wine to be able to run it, and macOS users will additionally have to use the 64-bit version.
Other debugging emulators are possible (such as SameBoy on macOS), but I will be giving directives for and including screenshots of BGB.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="hello-world"><a class="header" href="#hello-world">Hello World!</a></h1>
<p>In this lesson, we will begin by assembling our first program.
The rest of this chapter will be dedicated to explaining how and why it works.</p>
<p>Note that we will need to type a lot of commands, so open a terminal now.
It‚Äôs a good idea to create a new directory (<code>mkdir gb_hello_world</code>, for example, then <code>cd gb_hello_world</code> to enter the new directory).</p>
<p>Grab the following files (right-click each link, ‚ÄúSave Link As...‚Äù), and place them all in this new directory:</p>
<ul>
<li><a href="part1/../assets/hello-world.asm"><code>hello-world.asm</code></a></li>
<li><a href="https://raw.githubusercontent.com/gbdev/hardware.inc/v4.0/hardware.inc"><code>hardware.inc</code></a></li>
</ul>
<p>Then, still from a terminal within that directory, run the following three commands.</p>
<div class="box warning decorated">
<div><p>‚ö†Ô∏è</p></div>
<div>
<p>For clarity, a <code>$</code> has been added at the beginning of each command, but don‚Äôt copy-paste them!</p>
</div>
</div>
<pre><code class="language-console">$ rgbasm -L -o hello-world.o hello-world.asm
$ rgblink -o hello-world.gb hello-world.o
$ rgbfix -v -p 0xFF hello-world.gb
</code></pre>
<style>
	.box.danger ol {
		list-style-type: symbols(fixed "üëç" "üëé");
	}
</style>
<div class="box danger decorated">
<div><p>‚ÄºÔ∏è</p></div>
<div>
<p>Be careful with arguments! They must be in a certain order, and must all be separated by some whitespace (though any amount works). If you need whitespace within an argument, you must quote it:</p>
<ol>
<li><code>rgbasm -L -o hello world.o hello world.asm</code> won‚Äôt work</li>
<li><code>rgbasm -L -o &quot;hello world.o&quot; &quot;hello world.asm&quot;</code> will work</li>
</ol>
<!-- This separates the two lists -->
<ol>
<li><code>rgbasm -L -o hello-world.asm hello-world.o</code> won‚Äôt work (and may corrupt <code>hello-world.asm</code>!)</li>
<li><code>rgbasm hello-world.asm -o hello-world.o</code> will work</li>
</ol>
</div>
</div>
<p>It should look like this:</p>
<script id="asciicast-weljUlcp1KC5GqS9jqV62dy5m" src="https://asciinema.celforyon.fr/a/weljUlcp1KC5GqS9jqV62dy5m.js" async></script>
<p>(If you encounter an error you can‚Äôt figure out by yourself, don‚Äôt be afraid to <a href="part1/../index.html#feedback">ask us</a>! We‚Äôll sort it out.)</p>
<p>Congrats!
You just assembled your first Game Boy ROM!
Now, we just need to run it; open BGB, right-click the window that opened, and load <code>hello-world.gb</code>.</p>
<video controls poster="../assets/vid/hello_world.poster.png">
	<source src="../assets/vid/hello_world.webm" type="video/webm">
	<source src="../assets/vid/hello_world.mp4" type="video/mp4">
<pre><code>&lt;img src=&quot;../assets/vid/hello_world.gif&quot; alt=&quot;Video demonstration in BGB&quot;&gt;
</code></pre>
</video>
<p>You could also take a flash cart (I use the <a href="https://krikzz.com/store/home/47-everdrive-gb.html">EverDrive GB X5</a>, but there are plenty of alternatives), load up your ROM onto it, and run it on an actual console!</p>
<p><img src="part1/../assets/img/hello_dmg.jpg" alt="Picture of the Hello World running on a physical DMG" /></p>
<p>Well, now that we have something working, it‚Äôs time to peel back the curtains...</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="the-toolchain"><a class="header" href="#the-toolchain">The toolchain</a></h1>
<p>So, in the previous lesson, we built a nice little ‚ÄúHello World!‚Äù ROM.
Now, let‚Äôs find out exactly what we did.</p>
<h2 id="rgbasm-and-rgblink"><a class="header" href="#rgbasm-and-rgblink">RGBASM and RGBLINK</a></h2>
<p>Let‚Äôs begin by explaining what <code>rgbasm</code> and <code>rgblink</code> do.</p>
<p>RGBASM is an <em>assembler</em>.
It is responsible for reading the source code (in our case, <code>hello-world.asm</code> and <code>hardware.inc</code>), and generating blocks of code with some ‚Äúholes‚Äù.
RGBASM does not always have enough information to produce a full ROM, so it does most of the work, and stores its intermediary results in what‚Äôs known as <em>object files</em> (hence the <code>.o</code> extension).</p>
<p>RGBLINK is a <em>linker</em>.
Its job is taking object files (or, like in our case, just one), and ‚Äúlinking‚Äù them into a ROM.
RGBLINK‚Äôs purpose may not be obvious for programs as simple as this Hello World, but it will become much clearer in Part II.</p>
<p>So: Source code ‚Üí <code>rgbasm</code> ‚Üí Object files ‚Üí <code>rgblink</code> ‚Üí ROM, right?
Well, not exactly.</p>
<h2 id="rgbfix"><a class="header" href="#rgbfix">RGBFIX</a></h2>
<p>RGBLINK does produces a ROM, but it‚Äôs not quite usable yet.
See, actual ROMs have what‚Äôs called a <em>header</em>.
It‚Äôs a special area of the ROM that contains <a href="https://gbdev.io/pandocs/#the-cartridge-header">metadata about the ROM</a>; for example, the game‚Äôs name, Game Boy Color compatibility, and more.
For simplicity, we defaulted a lot of these values to 0 for the time being; we‚Äôll come back to them in Part II.</p>
<p>However, the header contains three crucial fields:</p>
<ul>
<li>The <a href="https://gbdev.io/pandocs/#_0104-0133-nintendo-logo">Nintendo logo</a>,</li>
<li>the <a href="https://gbdev.io/pandocs/#_0148-rom-size">ROM‚Äôs size</a>,</li>
<li>and <a href="https://gbdev.io/pandocs/#_014d-header-checksum">two checksums</a>.</li>
</ul>
<p>When the console first starts up, it runs <a href="https://github.com/ISSOtm/gb-bootroms">a little program</a> known as the <em>boot ROM</em>, which reads and draws the logo from the cartridge, and displays the little boot animation.
When the animation is finished, the console checks if the logo matches a copy that it stores internally; if there is a mismatch, <strong>it locks up!</strong>
And, since it locks up, our game never gets to run... üò¶
This was meant as an anti-piracy measure; however, that measure <a href="https://en.wikipedia.org/wiki/Sega_v._Accolade">has since then been ruled as invalid</a>, so don‚Äôt worry, we are clear! üòÑ</p>
<p>Similarly, the boot ROM also computes a <em><a href="https://en.wikipedia.org/wiki/Checksum">checksum</a></em> of the header, supposedly to ensure that it isn‚Äôt corrupted.
The header also contains a copy of this checksum; if it doesn‚Äôt match what the boot ROM computed, then the boot ROM <strong>also locks up!</strong></p>
<p>The header also contains a checksum over the whole ROM, but nothing ever uses it.
It doesn‚Äôt hurt to get it right, though.</p>
<p>Finally, the header also contains the ROM‚Äôs size, which is required by emulators and flash carts.</p>
<p>RGBFIX‚Äôs role is to fill in the header, especially these 3 fields, which are required for our ROM to be guaranteed to run fine.
The <code>-v</code> option instructs RGBFIX to make the header <strong>v</strong>alid, by injecting the Nintendo logo and computing the two checksums.
The <code>-p 0xFF</code> option instructs it to <strong>p</strong>ad the ROM to a valid size, and set the corresponding value in the ‚ÄúROM size‚Äù header field.</p>
<p>Alright!
So the full story is: Source code ‚Üí <code>rgbasm</code> ‚Üí Object files ‚Üí <code>rgblink</code> ‚Üí ‚ÄúRaw‚Äù ROM ‚Üí <code>rgblink</code> ‚Üí ‚ÄúFixed‚Äù ROM.
Good.</p>
<p>You might be wondering why RGBFIX‚Äôs functionality hasn‚Äôt been included directly in RGBLINK.
There are some historical reasons, but RGBLINK can also be used to produce things other than ROMs (especially via the <code>-x</code> option), and RGBFIX is sometimes used without RGBLINK anywhere in sight.</p>
<h2 id="file-names"><a class="header" href="#file-names">File names</a></h2>
<p>Note that RGBDS does not care at all about the files‚Äô extensions.
Some people call their source code <code>.s</code>, for example, or their object files <code>.obj</code>.
The file names don‚Äôt matter, either; it‚Äôs just practical to keep the same name.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="binary-and-hexadecimal"><a class="header" href="#binary-and-hexadecimal">Binary and hexadecimal</a></h1>
<p>Before we talk about the code, a bit of background knowledge is in order.
When programming at a low level, understanding of <em><a href="https://en.wikipedia.org/wiki/Binary_number">binary</a></em> and <em><a href="https://en.wikipedia.org/wiki/Hexadecimal">hexadecimal</a></em> is mandatory.
Since you may already know about both of these, a summary of the RGBDS-specific information is available at the end of this lesson.</p>
<p>So, what‚Äôs binary?
It‚Äôs a different way to represent numbers, in what‚Äôs called <em>base 2</em>.
We‚Äôre used to counting in <a href="https://en.wikipedia.org/wiki/Decimal">base 10</a>, so we have 10 digits: 0, 1, 2, 3, 4, 5, 6, 7, 8, and 9.
Here‚Äôs how digits work:</p>
<pre><code>  42 =                       4 * 10   + 2
     =                       4 * 10^1 + 2 * 10^0
                                  ‚Üë          ‚Üë
    These tens come from us counting in base 10!

1024 = 1 * 1000 + 0 * 100  + 2 * 10   + 4
     = 1 * 10^3 + 0 * 10^2 + 2 * 10^1 + 4 * 10^0
       ‚Üë          ‚Üë          ‚Üë          ‚Üë
And here we can see the digits that make up the number!
</code></pre>
<div class="box tip decorated">
<div><p>‚ÑπÔ∏è</p></div>
<div>
<p><code>^</code> here means ‚Äúto the power of‚Äù, where <code>X^N</code> is equal to multiplying <code>X</code> with itself <code>N</code> times, and <code>X ^ 0 = 1</code>.</p>
</div>
</div>
<p>Decimal digits form a unique <em>decomposition</em> of numbers in powers of 10 (<em>deci</em>mal is base 10, remember?).
But why stop at powers of 10?
We could use other bases instead, such as base 2.
(Why base 2 specifically will be explained later.)</p>
<p>Binary is base 2, so there are only two digits, called <em>bits</em>: 0 and 1.
Thus, we can generalize the principle outlined above, and write these two numbers in a similar way:</p>
<pre><code>  42 =                                                    1 * 32  + 0 * 16  + 1 * 8   + 0 * 4   + 1 * 2   + 0
     =                                                    1 * 2^5 + 0 * 2^4 + 1 * 2^3 + 0 * 2^2 + 1 * 2^1 + 0 * 2^0
                                                              ‚Üë         ‚Üë         ‚Üë         ‚Üë         ‚Üë         ‚Üë
                                          And since now we're counting in base 2, we're seeing twos instead of tens!

1024 = 1 * 1024 + 0 * 512 + 0 * 256 + 0 * 128 + 0 * 64  + 0 * 32  + 0 * 16  + 0 * 8   + 0 * 4   + 0 * 2   + 0
     = 1 * 2^10 + 0 * 2^9 + 0 * 2^8 + 0 * 2^7 + 0 * 2^6 + 0 * 2^5 + 0 * 2^4 + 0 * 2^3 + 0 * 2^2 + 0 * 2^1 + 0 * 2^0
       ‚Üë          ‚Üë         ‚Üë         ‚Üë         ‚Üë         ‚Üë         ‚Üë         ‚Üë         ‚Üë         ‚Üë         ‚Üë
</code></pre>
<p>So, by applying the same principle, we can say that in base 2, 42 is written as <code>101010</code>, and 2048 as <code>1000000000</code>.
Since you can‚Äôt tell ten (decimal 10) and two (binary 10) apart, RGBDS assembly has binary numbers prefixed by a percent sign: 10 is ten, and %10 is two.</p>
<p>Okay, but why base 2 specifically?
Rather conveniently, a bit can only be 0 or 1, which are easy to represent as ‚ÄúON‚Äù or ‚ÄúOFF‚Äù, empty or full, etc!
If you want, at home, to create a one-bit memory, just take a box.
If it‚Äôs empty, it stores a 0; if it contains <em>something</em>, it stores a 1.
Computers thus primarily manipulate binary numbers, and this has a <em>slew</em> of implications, as we will see throughout this entire tutorial.</p>
<h2 id="hexadecimal"><a class="header" href="#hexadecimal">Hexadecimal</a></h2>
<p>To recap, decimal isn‚Äôt practical for a computer to work with, instead relying on binary (base 2) numbers.
Okay, but binary is really impractical to work with.
Take %10000000000, aka 2048; when in decimal only 4 digits are required, binary instead needs 10!
And, did you notice that I actually wrote one zero too many?
Fortunately, hexadecimal is here to save the day! ü¶∏</p>
<p>Base 16 works just the same as every other base, but with 16 digits, called <em>nibbles</em>: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, A, B, C, D, E, and F.</p>
<pre><code>  42 =            2 * 16   + 10
     =            2 * 16^1 + A * 16^0

1024 = 4 * 256  + 0 * 16   + 0
     = 4 * 16^2 + 2 * 16^1 + 4 * 16^0
</code></pre>
<p>Like binary, we will use a prefix to denote hexadecimal, namely <code>$</code>.
So, 42 = $2A, and 1024 = $400.
This is <em>much</em> more compact than binary, and slightly more than decimal, too; but what makes hexadecimal very interesting is that one nibble corresponds <em>exactly</em> to 4 bits!</p>
<table><thead><tr><th align="center">Nibble</th><th align="center">Bits</th></tr></thead><tbody>
<tr><td align="center">$0</td><td align="center">%0000</td></tr>
<tr><td align="center">$1</td><td align="center">%0001</td></tr>
<tr><td align="center">$2</td><td align="center">%0010</td></tr>
<tr><td align="center">$3</td><td align="center">%0011</td></tr>
<tr><td align="center">$4</td><td align="center">%0100</td></tr>
<tr><td align="center">$5</td><td align="center">%0101</td></tr>
<tr><td align="center">$6</td><td align="center">%0110</td></tr>
<tr><td align="center">$7</td><td align="center">%0111</td></tr>
<tr><td align="center">$8</td><td align="center">%1000</td></tr>
<tr><td align="center">$9</td><td align="center">%1001</td></tr>
<tr><td align="center">$A</td><td align="center">%1010</td></tr>
<tr><td align="center">$B</td><td align="center">%1010</td></tr>
<tr><td align="center">$C</td><td align="center">%1100</td></tr>
<tr><td align="center">$D</td><td align="center">%1101</td></tr>
<tr><td align="center">$E</td><td align="center">%1110</td></tr>
<tr><td align="center">$F</td><td align="center">%1111</td></tr>
</tbody></table>
<p>This makes it very easy to convert between binary and hexadecimal, while retaining a compact enough notation.
Thus, hexadecimal is used a lot more than binary.
And, don‚Äôt worry, decimal can still be used üòú</p>
<p>(Side note: one could point that octal, i.e. base 8, would also work for this; however, we will primarily deal with units of 8 bits, for which hexadecimal works much better than octal. RGBDS supports octal via the <code>&amp;</code> prefix, but I have yet to see it used.)</p>
<div class="box tip decorated">
<div><p>üí°</p></div>
<div>
<p>If you‚Äôre having trouble converting between decimal and binary/hexadecimal, check if your favorite calculator program doesn‚Äôt have a ‚Äúprogrammer‚Äù mode, or a way to convert between bases.</p>
</div>
</div>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<ul>
<li>In RGBDS assembly, the hexadecimal prefix is <code>$</code>, and the binary prefix is <code>%</code>.</li>
<li>Hexadecimal can be used as a ‚Äúcompact binary‚Äù notation.</li>
<li>Using binary or hexadecimal is useful when individual bits matter; otherwise, decimal works just as well.</li>
<li>For when numbers get a bit too long, RGBASM allows underscores between digits (<code>123_465</code>, <code>%10_1010</code>, <code>$DE_AD_BE_EF</code>, etc.)</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="registers"><a class="header" href="#registers">Registers</a></h1>
<p>Alright!
Now that we know what bits are, let‚Äôs talk about how they‚Äôre used.
Don‚Äôt worry, this is mostly prep work for the next section, where we will‚Äîfinally!‚Äîlook at the code üëÄ</p>
<p>First, if you opened BGB, you have been greeted with just the Game Boy screen.
So, it‚Äôs time we pop the debugger open!
Right-click the screen, select ‚ÄúOther‚Äù, and click ‚ÄúDebugger‚Äù.
Oh, and while we‚Äôre at this, we might as well increase the screen size a little.</p>
<video controls poster="../assets/vid/debugger.poster.jpg">
	<source src="../assets/vid/debugger.webm" type="video/webm">
	<source src="../assets/vid/debugger.mp4" type="video/mp4">
<pre><code>&lt;img src=&quot;../assets/vid/debugger.gif&quot; alt=&quot;Video demonstration in BGB&quot;&gt;
</code></pre>
</video>
<p>The debugger may look intimidating at first, but don‚Äôt worry, soon we‚Äôll be very familiar with it!
For now, let‚Äôs focus on this small box near the top-right, the <em>register viewer</em>.</p>
<p><img src="part1/../assets/img/reg_viewer.png" alt="Picture of the register viewer‚Äôs location" /></p>
<div class="box warning decorated">
<div><p>‚ö†Ô∏è</p></div>
<div>
<p>The register viewer shows both <em>CPU registers</em> and some <em>hardware registers</em>.
This lesson will only deal with CPU registers, so that‚Äôs why we will be ignoring some of the entries here.</p>
</div>
</div>
<p>What are CPU registers?
Well, imagine you‚Äôre preparing a cake.
You will be following a recipe, whose instructions may be ‚Äúmelt 125g of chocolate and 125g of butter, blend with 2 eggs‚Äù and so on.
You will fetch some ingredients from the fridge as needed, but you don‚Äôt cook inside the fridge; for that, you have a small workspace.</p>
<p>Registers are pretty much the CPU‚Äôs workspace.
They are small, tiny chunks of memory embedded directly in the CPU (only 10 bytes for the Game Boy‚Äôs CPU, and even modern CPUs have less than a kilobyte if you don‚Äôt count <a href="https://en.wikipedia.org/wiki/SIMD"><abbr title="Single Instruction, Multiple Data">SIMD</abbr></a> registers).
Operations are not performed directly on data stored in memory, which would be equivalent to breaking eggs directly inside our fridge, but they are performed on registers.</p>
<div class="box tip decorated">
<div><p>‚ÑπÔ∏è</p></div>
<div>
<p>There are exceptions to this rule, like many other ‚Äúrules‚Äù I will give in this tutorial; I will paper over them to keep the mental complexity reasonable, but don‚Äôt treat my word as gospel either.</p>
</div>
</div>
<h2 id="general-purpose-registers"><a class="header" href="#general-purpose-registers">General-purpose registers</a></h2>
<p>CPU registers can be placed into two categories: <em>general-purpose</em> and <em>special-purpose</em>.
A ‚Äúgeneral-purpose‚Äù register (<abbr title="General-Purpose Register">GPR</abbr> for short) can be used for storing arbitrary data.
Some GPRs are special nonetheless, as we will see later; but the distinction is ‚Äúcan I store arbitrary data in it?‚Äù.</p>
<p>I won‚Äôt introduce special-purpose registers quite yet, as their purpose wouldn‚Äôt make sense yet.
Rather, they will be discussed as the relevant concepts are introduced.</p>
<p>The Game Boy CPU has seven 8-bit GPRs: <code>a</code>, <code>b</code>, <code>c</code>, <code>d</code>, <code>e</code>, <code>h</code>, and <code>l</code>.
‚Äú8-bit‚Äù means that, well, they store 8 bits.
Thus, they can store integers from 0 to 255 (%1111_1111 aka $FF).</p>
<p><code>a</code> is the <em>accumulator</em>, and we will see later that it can be used in special ways.</p>
<p>A special feature is that these registers, besides <code>a</code>, are <em>paired up</em>, and the pairs can be treated as the 16-bit registers <code>bc</code>, <code>de</code>, and <code>hl</code>.
The pairs are <em>not</em> separate from the individual registers; for example, if <code>d</code> contains 192 ($C0) and <code>e</code> contains 222 ($DE), then <code>de</code> contains 49374 ($C0DE) = 192 * 256 + 222.
The other pairs work similarly.</p>
<p>Modifying <code>de</code> actually modifies both <code>d</code> and <code>e</code> at the same time, and modifying either individually also affects the pair.
How do we modify registers?
Let‚Äôs see how, with out first assembly instructions!</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="assembly-basics"><a class="header" href="#assembly-basics">Assembly basics</a></h1>
<p>Alright, now that we know what the tools <em>do</em>, let‚Äôs see what language RGBASM speaks.
I will take a short slice of the beginning of <code>hello-world.asm</code>, so that we agree on line numbers and you can get some syntax highlighting even if your editor doesn‚Äôt support it.</p>
<pre><code class="language-rgbasm linenos">INCLUDE &quot;hardware.inc&quot;

SECTION &quot;Header&quot;, ROM0[$100]

	di
	jp EntryPoint

	ds $150 - @, 0 ; Make room for the header

SECTION &quot;Code&quot;, ROM0

EntryPoint:
	; Kill sound
	ld a, 0
	ld [rNR52], a
</code></pre>
<p>Let‚Äôs analyze it.
Note that I will be ignoring a <em>lot</em> of RGBASM‚Äôs functionality; if you‚Äôre curious to know more, you should wait until parts II and III, or <a href="https://rgbds.gbdev.io/docs">read the docs</a>.</p>
<h2 id="comments"><a class="header" href="#comments">Comments</a></h2>
<p>We‚Äôll start with line 13, which should appear gray above.
Semicolons <code>;</code> denote <em>comments</em>.
Everything from a semicolon to the end of the line is <em>ignored</em> by RGBASM.
As you can see on line 8, comments need not be on an otherwise empty line.</p>
<p>Comments are a staple of every good programming language; they are useful to give context as to what code is doing.
They‚Äôre the difference between ‚ÄúPre-heat the oven at 180 ¬∞C‚Äù and ‚ÄúPre-heat the oven at 180 ¬∞C, any higher and the cake would burn‚Äù, basically.
In any language, good comments are very useful; in assembly, they play an even more important role, as many common semantic facilities are not available.</p>
<h2 id="instructions"><a class="header" href="#instructions">Instructions</a></h2>
<p>Assembly is a very line-based language.
Each line can contain a <em>directive</em>, which instructs RGBASM to do something, or an <em>instruction</em><sup class="footnote-reference"><a href="#instr_directive">1</a></sup>, which is copied directly into the ROM.
We will talk about directives later, for now let‚Äôs focus on instructions: for example, in the snippet above, we will ignore lines 1 (<code>INCLUDE</code>), 8 (<code>ds</code>), and 3 (<code>SECTION</code>).</p>
<p>To continue the cake-baking analogy even further, instructions are like steps in a recipe.
The console‚Äôs processor (<abbr title="Central Processing Unit">CPU</abbr>) executes instructions one at a time, and that... eventually does something!
Like baking a cake, drawing a ‚ÄúHello World‚Äù image, or displaying a Game Boy programming tutorial!
*wink* *wink*</p>
<p>Instructions have a <em>mnemonic</em>, which is a name they are given, and <em>operands</em>, which indicate what they should act upon.
For example, in ‚Äúmelt the chocolate and butter in a saucepan‚Äù, <em>the whole sentence</em> would be the instruction, <em>the verb</em> ‚Äúmelt‚Äù would be the mnemonic, and ‚Äúchocolate‚Äù, ‚Äúbutter‚Äù, and ‚Äúsaucepan‚Äù the operands, i.e. some kind of parameters to the operation.</p>
<p>Let‚Äôs discuss the most fundamental instruction, <strong><code>ld</code></strong>.
<code>ld</code> stands for ‚ÄúLoaD‚Äù, and its purpose is simply to copy data from its right operand (<a href="https://en.wikipedia.org/wiki/Sides_of_an_equation">‚Äú<abbr title="Right-Hand Side">RHS</abbr>‚Äú</a>) into its left operand (<a href="https://en.wikipedia.org/wiki/Sides_of_an_equation">‚Äú<abbr title="Left-Hand Side">LHS</abbr>‚Äú</a>).
For example, take line 14‚Äôs <code>ld a, 0</code>: it copies (‚Äùloads‚Äù) the value 0 into the 8-bit register <code>a</code><sup class="footnote-reference"><a href="#ld_imm_from">2</a></sup>.
If you look further in the file, line 42 has <code>ld a, b</code>, which causes the value in register <code>b</code> to be copied into register <code>a</code>.</p>
<table><thead><tr><th>Instruction</th><th>Mnemonic</th><th>Effect</th></tr></thead><tbody>
<tr><td>Load</td><td><code>ld</code></td><td>Copies values around</td></tr>
</tbody></table>
<div class="box tip decorated">
<div><p>‚ÑπÔ∏è</p></div>
<div>
<p>Due to CPU limitations, not all operand combinations are valid for <code>ld</code> and many other instructions; we will talk about this when writing our own code later.</p>
</div>
</div>
<div class="box tip decorated">
<div><p>ü§î</p></div>
<div>
<p>RGBDS has an <a href="https://rgbds.gbdev.io/docs/v0.5.1/gbz80.7">instruction reference</a> worth bookmarking, and you can also consult it locally with <code>man 7 gbz80</code> if RGBDS is installed on your machine (except Windows...).
The descriptions there are more succinct, since they‚Äôre intended as reminders, not as tutorials.</p>
</div>
</div>
<div class="footnote-definition" id="instr_directive"><sup class="footnote-definition-label">1</sup>
<p>Technically, instructions in RGBASM are implemented as directives, basically writing their encoded form to the ROM; but the distinction between the instructions in the source code and those in the final ROM is not worth bringing up right now.</p>
</div>
<div class="footnote-definition" id="ld_imm_from"><sup class="footnote-definition-label">2</sup>
<p>The curious reader may ask where the value is copied <em>from</em>. The answer is simply that the ‚Äúimmediate‚Äú byte ($00 in this example) is stored in ROM just after the instruction‚Äôs opcode byte, and it‚Äôs what gets copied to <code>a</code>.
We will come back to this when we talk about how instructions are encoded later on.</p>
</div>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="memory"><a class="header" href="#memory">Memory</a></h1>
<div class="box tip decorated">
<div><p>üéâ</p></div>
<div>
<p>Congrats, you have just finished the hardest lessons of the tutorial!
Since you have the basics, from now on, we‚Äôll be looking at more and more concrete code.</p>
</div>
</div>
<p>If we look at line 37, we see <code>ld a, [de]</code>.
Given what we just learned, this copies a value into register <code>a</code>... but where from?
What do these brackets mean?
To answer that, we need to talk about <em>memory</em>.</p>
<h2 id="whats-a-memory"><a class="header" href="#whats-a-memory">What‚Äôs a memory?</a></h2>
<p>The purpose of memory is to store information.
On a piece of paper or a whiteboard, you can write letters to store the grocery list, for example.
But what can you store in a computer memory?
The answer to that question is <em>current</em><sup class="footnote-reference"><a href="#memory_magnetic">1</a></sup>.
Computer memory is made of little cells that can store current.
But, as we saw in the lesson about binary, the presence or absence of current can be used to encode binary numbers!</p>
<p>tl;dr: memory <strong>stores numbers</strong>.
In fact, memory is a <em>long</em> array of numbers, stored in cells.
To uniquely identify each cell, it‚Äôs given a number (what else!) called its <em>address</em>.
Like street numbers!
The first cell has address 0, then address 1, 2, and so on.
On the Game Boy, each cell contains <em>8 bits</em>, i.e. a <em>byte</em>.</p>
<p>How many cells are there?
Well, this is actually a trick question...</p>
<h2 id="the-many-types-of-memory"><a class="header" href="#the-many-types-of-memory">The many types of memory</a></h2>
<p>There are several memory chips in the Game Boy, but we can put them into two categories: <abbr title="Read-Only Memory">ROM</abbr> and <abbr title="Random Access Memory">RAM</abbr><sup class="footnote-reference"><a href="#rom_ram_and">2</a></sup>.
ROM simply designates memory that cannot be written to<sup class="footnote-reference"><a href="#rom_ro">3</a></sup>, and RAM memory that can be written to.</p>
<p>Due to how they work, the CPU, as well as the memory chips, can only use a single number for addresses.
Let‚Äôs go back to the ‚Äústreet numbers‚Äù analogy: each memory chip is a street, with its own set of numbers, but the CPU has no idea what a street is, it only deals with street numbers.
To allow the CPU to talk to multiple chips, a sort of ‚Äúpostal service‚Äù, the <em>chip selector</em>, is tasked with translating the CPU‚Äôs street numbers into a street &amp; street number.</p>
<p>For example, let‚Äôs say a convention is established where addresses 0 through 1999 go to chip A‚Äôs addresses 0‚Äì1999, 2000‚Äì2999 to chip B‚Äôs 0‚Äì999, and 3000‚Äì3999 to chip C‚Äôs 0‚Äì999.
Then, if the CPU asks for the byte at address 2791, the chip selector will ask chip B for the byte at its <em>own</em> address 791, and forward the reply to the CPU.</p>
<p>Since addresses dealt with by the CPU do not directly correspond to the chips‚Äô addresses, we talk about <em>logical</em> addresses (here, the CPU‚Äôs) versus <em>physical</em> addresses (here, the chips‚Äô), and the correspondence is called a <em>memory map</em>.
Since we are programming the CPU, we will only be dealing with <strong>logical</strong> addresses, but it‚Äôs crucial to keep in mind that different addresses may be backed by different memory chips, since each chip has unique characteristics.</p>
<p>This may sound complicated, so here is a summary:</p>
<ul>
<li>Memory stores numbers, each 8-bit on the Game Boy.</li>
<li>Memory is accessed byte by byte, and the cell being accessed is determined by an <em>address</em>, which is just a number.</li>
<li>The CPU deals with all memory uniformly, but there are several memory chips each with their own characteristics.</li>
</ul>
<h3 id="game-boy-memory-map"><a class="header" href="#game-boy-memory-map">Game Boy memory map</a></h3>
<p>Let‚Äôs answer the question that introduced this section: how many memory cells are there on the Game Boy?
Well, now, we can reframe this question as ‚Äúhow many logical addresses are there?‚Äù or ‚Äúhow many physical addresses are there in total?‚Äù.</p>
<p>Logical addresses, which again are just numbers, are 16-bit on the Game Boy.
Therefore, there are 2^16 = 65536 logical addresses, from $0000 to $FFFF.
How many physical addresses, though?
Well, here is a memory map <a href="https://gbdev.io/pandocs/#memory-map">courtesy of Pan Docs</a> (though I will simplify it a bit):</p>
<table><thead><tr><th>Start</th><th>End</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>$0000</td><td>$7FFF</td><td>ROM</td><td>The game ROM, supplied by the cartridge.</td></tr>
<tr><td>$8000</td><td>$9FFF</td><td>VRAM</td><td>Video RAM, where graphics are stored and arranged.</td></tr>
<tr><td>$A000</td><td>$BFFF</td><td>SRAM</td><td>Save RAM, optionally supplied by the cartridge to save data to.</td></tr>
<tr><td>$C000</td><td>$DFFF</td><td>WRAM</td><td>Work RAM, general-purpose RAM for the game to store things in.</td></tr>
<tr><td>$FE00</td><td>$FE9F</td><td>OAM</td><td>Object Attribute Memory, where ‚Äúobjects‚Äù are stored.</td></tr>
<tr><td>$FF00</td><td>$FF7F</td><td>I/O</td><td>Neither ROM nor RAM, but this is where you control the console.</td></tr>
<tr><td>$FF80</td><td>$FFFE</td><td>HRAM</td><td>High RAM, a tiny bit of general-purpose RAM which can be accessed faster.</td></tr>
<tr><td>$FFFF</td><td>$FFFF</td><td>IE</td><td>A lone I/O byte that‚Äôs separated from the rest for some reason.</td></tr>
</tbody></table>
<p>$8000 + $2000 + $2000 + $2000 + $A0 + $80 + $7F + 1 adds up to $E1A0, or 57760 bytes of memory that can be <em>actually</em> accessed.
The curious reader will naturally ask, ‚ÄúWhat about the remaining 7776 bytes? What happens when accessing them?‚Äù; the answer is: ‚ÄúIt depends, it‚Äôs complicated; avoid accessing them‚Äù.</p>
<h2 id="what-with-the-brackets"><a class="header" href="#what-with-the-brackets">What with the brackets?</a></h2>
<p>Right, we came into this because we wanted to know what the brackets in <code>ld a, [de]</code> mean.
Well, they can basically be read as ‚Äúat address...‚Äù.
For example, <code>ld a, b</code> can be read as ‚Äúcopy into <code>a</code> to value stored in <code>b</code>‚Äú; <code>ld a, [$5414]</code> would be read as ‚Äúcopy into <code>a</code> the value stored at address $5414‚Äù, and <code>ld a, [de]</code> would be read as ‚Äúcopy into <code>a</code> the value stored at address <code>de</code>‚Äú.
Wait, what does that mean?
Well, if <code>de</code> contains the value $5414, then <code>ld a, [de]</code> will do the same thing as <code>ld a, [$5414]</code>.</p>
<p>If you‚Äôre familiar with C, the brackets are basically how the dereference operator is implemented.</p>
<h3 id="hli"><a class="header" href="#hli"><code>hli</code></a></h3>
<p>An astute reader will have noticed the <code>ld [hli], a</code> just below the <code>ld a, [de]</code> we have just studied.
<code>[de]</code> makes sense because it‚Äôs one of the register pairs we saw a couple lessons ago, but <code>[hli]</code>?
It‚Äôs actually a special notation, which can also be written as <code>[hl+]</code>.
It functions as <code>[hl]</code>, but <code>hl</code> is <em>incremented</em> just after memory is accessed.
<code>[hld]</code>/<code>[hl-]</code> is the mirror of this one, <em>decrementing</em> <code>hl</code> instead of incrementing it.</p>
<h2 id="an-example"><a class="header" href="#an-example">An example</a></h2>
<p>So, if we look at the first two instructions of <code>Memcpy</code>:</p>
<pre><code class="language-rgbasm">	ld a, [de]
	ld [hli], a
</code></pre>
<p>...we can see that we‚Äôre copying the byte in memory <em>pointed to</em> by <code>de</code> (that is, whose address is contained in <code>de</code>) into the byte pointed to by <code>hl</code>.
Here, <code>a</code> serves as temporary storage, since the CPU is unable to perform <code>ld [hl], [de]</code> directly.</p>
<p>While we‚Äôre at this, let‚Äôs examine the rest of <code>Memcpy</code>!</p>
<div class="footnote-definition" id="memory_magnetic"><sup class="footnote-definition-label">1</sup>
<p>Actually, this depends a lot on the type of memory.
A lot of memory nowadays uses magnetic storage, but to keep the explanation simple, and to parallel the explanation of binary given earlier, let‚Äôs assume that current is being used.</p>
</div>
<div class="footnote-definition" id="rom_ram_and"><sup class="footnote-definition-label">2</sup>
<p>There are other types of memory, such as flash memory or EEPROM, but only Flash has been used on the Game Boy, and for only a handful of games; so we can mostly forget about them.</p>
</div>
<div class="footnote-definition" id="rom_ro"><sup class="footnote-definition-label">3</sup>
<p>No, really!
Mask ROM is created by literally punching holes into a layer of silicon using acid, and e.g. the console‚Äôs boot ROM is made of hard-wired transitors within the CPU die.
Good luck writing to that!
<br>
‚ÄúROM‚Äù is sometimes (mis)used to refer to ‚Äúpersistent memory‚Äù chips, such as flash memory, whose write functionality was disabled.
Most bootleg / ‚Äúrepro‚Äù Game Boy cartridges you can find nowadays actually contain flash; this is why you can reflash them using specialized hardware, but not original cartridges.</p>
</div>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="operations--flags"><a class="header" href="#operations--flags">Operations &amp; flags</a></h1>
<p>Alright, we know how to pass values around, but just copying numbers is no fun; we want to modify them!</p>
<p>The GB CPU does not provide every operation under the sun (for example, there is no multiplication instruction), but we can just program those ourselves with what we have.
Let‚Äôs talk about some of the operations that it <em>does</em> have; I will be omitting some not used in the Hello World for now.</p>
<h2 id="arithmetic"><a class="header" href="#arithmetic">Arithmetic</a></h2>
<p>The simplest arithmetic instructions the CPU supports are <code>inc</code> and <code>dec</code>, which INCrement and DECrement their operand, respectively.
(If you aren‚Äôt sure, ‚Äúto increment‚Äù means ‚Äúto add 1‚Äù, and ‚Äúto decrement‚Äù means ‚Äúto subtract 1‚Äù.)
So, the <code>dec bc</code> line 57 simply subtracts 1 from <code>bc</code>.</p>
<p>Okay, cool!
Can we go a bit faster, though?
Sure we can, with <code>add</code> and <code>sub</code>!
These respectively ADD and SUBtract arbitrary values (either a constant, or a register).
Neither is used in the tutorial, but a sibling of <code>sub</code>‚Äòs is: have you noticed little <code>cp</code> over at line 20?
<code>cp</code> allows ComParing values.
It works the same as <code>sub</code>, but it discards the result instead of writing it back.
‚ÄúWait, so it does nothing?‚Äù you may ask; well, it <em>does</em> update the <strong>flags</strong>.</p>
<h2 id="flags"><a class="header" href="#flags">Flags</a></h2>
<p>The time has come to talk about the special-purpose register (remember those?) <code>f</code>, for, well, <em>flags</em>.
The <code>f</code> register contains 4 bits, called ‚Äúflags‚Äù, which are updated depending on an operation‚Äôs results.
These 4 flags are:</p>
<table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>Z</td><td>Zero flag</td></tr>
<tr><td>N</td><td>Addition/subtraction</td></tr>
<tr><td>H</td><td>Half-carry</td></tr>
<tr><td>C</td><td>Carry</td></tr>
</tbody></table>
<p>Yes, there is a flag called ‚ÄúC‚Äù and a register called ‚Äúc‚Äù, and <strong>they are different, unrelated things</strong>.
This makes the syntax a bit confusing at the beginning, but they are always used in different contexts, so it‚Äôs fine.</p>
<p>We will forget about N and H for now; let‚Äôs focus on Z and C.
Z is the simplest flag: it gets set when an operation‚Äôs result is 0, and gets reset otherwise.
C is set when an operation <em>overflows</em> or <em>underflows</em>.</p>
<p>What‚Äôs an overflow?
Let‚Äôs take the simple instruction <code>add a, 42</code>.
This simply adds 42 to the contents of register <code>a</code>, and writes the result back into <code>a</code>.</p>
<pre><code class="language-rgbasm">    ld a, 200
    add a, 42
</code></pre>
<p>At the end of this snippet, <code>a</code> equals 200 + 42 = 242, great!
But what if I write this instead?</p>
<pre><code class="language-rgbasm">    ld a, 220
    add a, 42
</code></pre>
<p>Well, one could think that <code>a</code> would be equal to 220 + 42 = 262, but that would be incorrect.
Remember, <code>a</code> is an 8-bit register, <em>it can only store eight bits of information</em>!
And if we were to write 262 in binary, we would get %100000110, which requires at least 9 bits...
So what happens?
Simply, that ninth bit is <em>lost</em>, and the value that we end up with is %00000110 = 6.
This is called an <em>overflow</em>: after <strong>adding</strong>, we obtain a value <strong>smaller</strong> than what we started with.</p>
<p>We can also do the opposite with <code>sub</code>, and‚Äîfor example‚Äîsubtract 42 from 6; as we know, for all <code>X</code> and <code>Y</code>, <code>X + Y - Y = X</code>, and we just saw that 220 + 42 = 6 (this is called <em>modulo 256 arithmetic</em>, by the way); so, 6 - 42 = (220 + 42) - 42 = 220.
This is called an <em>underflow</em>: after <strong>subtracting</strong>, we obtain a value <strong>greater</strong> than what we started with.</p>
<p>When an operation is performed, it sets the carry flag if an overflow or underflow occurred, and clears it otherwise.
(We will see later that not all operations update the carry flag, though.)</p>
<div class="box tip">
<p class="box-title">Summary</p><ul>
<li>We can add and subtract numbers.</li>
<li>The Z flag lets us know if the result was 0.</li>
<li>However, registers can only store a limited range of integers.</li>
<li>Going outside of this range is called an <strong>overflow</strong> or <strong>underflow</strong>, for addition and subtraction respectively.</li>
<li>The C flag lets us know if either occurred.</li>
</ul>
</div>
<h2 id="comparison"><a class="header" href="#comparison">Comparison</a></h2>
<p>Now, let‚Äôs talk more about how <code>cp</code> is used to compare numbers.
Here is a refresher: <code>cp</code> subtracts its operand from <code>a</code> and updates flags accordingly, but doesn‚Äôt write the result back.
We can use flags to check properties about the values being compared, and we will see in the next lesson how to use the flags.</p>
<p>The simplest interaction is with the Z flag.
If it‚Äôs set, we know that the subtraction yielded 0, i.e. <code>a - operand == 0</code>; therefore, <code>a == operand</code>!
If it‚Äôs not set, well, then we know that <code>a != operand</code>.</p>
<p>Okay, checking for equality is nice, but we may also want to perform <em>comparisons</em>.
Fret not, for the carry flag is here to do just that!
See, when performing a subtraction, the carry flag gets set when the result goes below 0‚Äîbut that‚Äôs just a fancy way of saying ‚Äúbecomes negative‚Äù!</p>
<p>So, when the carry flag gets set, we know that <code>a - operand &lt; 0</code>, therefore that <code>a &lt; operand</code>..!
And, conversely, we know that if it‚Äôs <em>not</em> set, <code>a &gt;= operand</code>.
Great!</p>
<h2 id="instruction-summary"><a class="header" href="#instruction-summary">Instruction summary</a></h2>
<table><thead><tr><th>Instruction</th><th>Mnemonic</th><th>Effect</th></tr></thead><tbody>
<tr><td>Add</td><td><code>add</code></td><td>Adds values to <code>a</code></td></tr>
<tr><td>Subtract</td><td><code>sub</code></td><td>Subtracts values from <code>a</code></td></tr>
<tr><td>Compare</td><td><code>cp</code></td><td>Compares values with what‚Äôs contained in <code>a</code></td></tr>
</tbody></table>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="jumps"><a class="header" href="#jumps">Jumps</a></h1>
<div class="box tip">
<p>Once this lesson is done, we will be able to understand all of <code>Memcpy</code>!</p>
</div>
<p>So far, all the code we have seen has been linear: it executes top to bottom.
But this doesn‚Äôt scale: sometimes, we need to perform certain actions depending on the result of others (‚Äùif you don‚Äôt have butter, grease the pan with oil instead‚Äù), and sometimes, we need to perform actions repeatedly (‚Äù... repeat while there is batter remaining‚Äù).</p>
<p>Both of these imply requiring the recipe non-lineraly.
In assembly, this is achieved using ‚Äújumps‚Äù.</p>
<p>The CPU has a special-purpose register called ‚ÄúPC‚Äù, for Program Counter.
It contains the address of the instruction currently being executed<sup class="footnote-reference"><a href="#pc_updates">1</a></sup>, as if you kept a finger on the recipe item you‚Äôre currently doing.
PC increases automatically as the CPU reads instructions, so ‚Äúby default‚Äù they are read sequentially; however, jump instructions allow writing a different value to PC, effectively <em>jumping</em> to another piece of the program.
Hence the name.</p>
<p>Okay, so, let‚Äôs talk about those jump instructions, shall we?
There are four of them:</p>
<table><thead><tr><th>Instruction</th><th>Mnemonic</th><th>Effect</th></tr></thead><tbody>
<tr><td>Jump</td><td><code>jp</code></td><td>Jump execution to a location</td></tr>
<tr><td>Jump Relative</td><td><code>jr</code></td><td>Jump to a location close by</td></tr>
<tr><td>Call</td><td><code>call</code></td><td>Call a subroutine</td></tr>
<tr><td>Return</td><td><code>ret</code></td><td>Return from a subroutine</td></tr>
</tbody></table>
<p>We will focus on <code>jp</code> for now.
<code>jp</code>, such as the one line 9, simply sets PC to its argument, jumping execution there.
In other words, after executing <code>jp EntryPoint</code> (line 9), the next instruction executed is the one below <code>EntryPoint</code> (line <!-- should be 15 + 1 --> 16).</p>
<div class="box tip decorated">
<div><p>ü§î</p></div>
<div>
<p>You may be wondering what that specific <code>jp</code>‚Äòs point is.
Don‚Äôt worry, we will see later why it‚Äôs required.</p>
</div>
</div>
<h2 id="conditional-jumps"><a class="header" href="#conditional-jumps">Conditional jumps</a></h2>
<p>Now to the <em>really</em> interesting part.
A very useful and unique property of the four jump instructions is that they can be executed <strong>conditoonally</strong>!
This is how you execute a block of code conditionally: if the condition is false, just skip over it!</p>
<p>Looping works similarly, by jumping backwards to the loop‚Äôs starting point.</p>
<div class="footnote-definition" id="pc_updates"><sup class="footnote-definition-label">1</sup>
<p>Not exactly; instructions may be several bytes long, and PC increments after reading each byte.
Notably, this means that when an instruction finishes executing, PC is pointing to the following instruction.
Still, it‚Äôs pretty much ‚Äúwhere the CPU is currently reading from‚Äù, but it‚Äôs better to keep it simple and avoid mentioning instruction encoding for now.</p>
</div>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="resources"><a class="header" href="#resources">Resources</a></h1>
<p>A.k.a. ‚Äúwhere to go from here‚Äù.</p>
<p>FIXME: This is not properly written yet...</p>
<ul>
<li><a href="https://gbdev.io">GBDev community home page</a> and <a href="https://gbdev.io/chat">chat channels</a>.</li>
<li><a href="https://rgbds.gbdev.io/docs/">RGBDS online documentation</a>, this includes <a href="https://rgbds.gbdev.io/docs/gbz80.7">an instruction reference</a>.</li>
<li><a href="https://gbdev.io/gb-opcodes/optables">A more compact instruction table</a>, more useful if you‚Äôre already familiar with the instructions.</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="special-thanks"><a class="header" href="#special-thanks">Special Thanks</a></h1>
<p>Big thank you to <a href="https://www.pouet.net/user.php?who=21982">Twoflower/Triad</a> for making the Hello World graphic.</p>
<p>I can‚Äôt thank enough Chlo√© and many others for their continued support.</p>
<p>Thanks to the GBDev community for being so nice throughout the years.</p>
<p><strong>You are all great. Thank you so very much.</strong></p>
<hr />
<p>Thank you to the <a href="https://www.rust-lang.org">Rust language</a> team for making <a href="https://github.com/rust-lang/mdBook">mdBook</a>, which powers this book (this honestly slick design is the stock one!!)</p>
<p>Greets to AYCE, Phantasy, TPPDevs/RainbowDevs, lft/kryo :)</p>
<p>Shoutouts to <a href="https://github.com/greenandeievui">GreenAndEievui</a>, <a href="https://github.com/basxto">Ba≈ùto</a>, <a href="https://github.com/bbbbbr">bbbbbr</a>, and <a href="https://github.com/bitnenfer">bitnenfer</a>!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="js/linenos.js"></script>
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
